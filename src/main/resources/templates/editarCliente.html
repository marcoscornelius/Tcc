<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Cliente</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous">
</head>
<body>
<div class="container">
    <h1>Editar Cliente</h1>
    <form id="editForm" th:object="${cliente}" th:action="@{/cliente/atualizarCliente}" method="post">
        <input type="hidden" th:field="*{id}">
        <div class="form-group">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" class="form-control" th:field="*{nome}" required>
        </div>
        <div class="form-group">
            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" class="form-control" th:field="*{endereco}" required>
        </div>
        <div class="form-group">
            <label for="telefone">Telefone:</label>
            <input type="text" id="telefone" class="form-control" th:field="*{telefone}" required>
        </div>
        <div class="form-group">
            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" class="form-control" th:field="*{cpf}" required>
        </div>
        <div class="form-group">
            <label for="duracao">Duração:</label>
            <input type="number" id="duracao" class="form-control" th:field="*{duracao}" required>
        </div>
        <div class="form-group">
            <label for="horario_entrada">Horário de Entrada:</label>
            <input type="text" id="horario_entrada" class="form-control" th:field="*{horario_entrada}" required>
        </div>
        <div class="form-group">
            <label for="data_pagamento">Data de Pagamento:</label>
            <input type="text" id="data_pagamento" class="form-control" th:field="*{data_pagamento}" required>
        </div>
        <button type="submit" class="btn btn-primary">Atualizar</button>      
        <input type="text" id="cpf2" style="display: none" class="form-control" th:field="*{cpf}">
    </form>
      <button id="deleteButton" class="btn btn-danger">Deletar Cliente</button>
</div>
    <script>
      document.getElementById("deleteButton").addEventListener("click", function() {
        var cpf = document.getElementById("cpf2").value; // Obter o CPF do campo oculto
       fetch("/cliente/deletar?cpf=" + cpf, {
        method: "DELETE"
    })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error("Erro ao excluir cliente");
            }
        })
        .then(data => {
            console.log("Cliente excluído com sucesso:", data);
            // Faça o que for necessário após excluir o cliente
        })
        .catch(error => {
            console.error("Erro ao excluir cliente:", error);
            // Trate o erro adequadamente
        });
    });
       document.getElementById("editForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Evita que o formulário seja enviado normalmente

            var form = event.target;
            var formData = new FormData(form); // Obtém os dados do formulário

            // Cria um objeto com os dados do formulário
            var formDataObject = {};
            formData.forEach(function(value, key){
                formDataObject[key] = value;
            });

            // Envia os dados do formulário como JSON para o servidor usando fetch
            fetch("/cliente/atualizarCliente", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(formDataObject)
            })
            .then(response => {
                if (response.ok) {
                    return response.json(); // Se a resposta estiver OK, retorna os dados JSON
                } else {
                    throw new Error("Erro ao enviar formulário"); // Caso contrário, lança um erro
                }
            })
            .then(data => {
                console.log("Resposta do servidor:", data); // Trata os dados recebidos do servidor
                // Faça o que for necessário com os dados recebidos do servidor, como mostrar uma mensagem de sucesso
            })
            .catch(error => {
                console.error("Erro:", error); // Trata erros de requisição
                // Faça o que for necessário em caso de erro, como mostrar uma mensagem de erro
            });
        });
    </script>
</body>
</html>